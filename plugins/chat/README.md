# 家庭云平台

<div style="float:left">
<img src="https://github.com/joincloud/docs/blob/master/home-platform/home-platform-arch.png" width="80%">
</div>


## 节点注册

## 节点查询

## 本地启动

A：

```
go run main.go -db-dir=E:\data\join_cloud\1\ -http-port=8090 -ipfs-port=8091
```

B：

```
go run main.go -db-dir=/Users/shuxian/Documents/join_cloud/db/2/ -http-port=9080 -ipfs-port=9091
```

## 接口说明

APP启动需要绑定的有：

专属边缘节点地址

### 拉取聊天

先写死两个用户id

请求路由

```
GET /pull-msg/{id:[0-9]+}/{from:[0-9]+}/{lastId:[0-9]+}
```

id为当前用户id，from为聊天对象id，lastId为最后一条消息的id，即下方的idx

响应结构

```
{
    "data": [
        {
            "idx": 1,
            "timestamp": 1603616583,
            "userId": 1,
            "data": "吃了没"
        },
        {
            "idx": 2,
            "timestamp": 1603616583,
            "userId": 2,
            "data": "没吃"
        }
    ]
}
```


### 推送聊天

接口

```
POST /push-msg/{id:[0-9]+}/{to:[0-9]+}
{
   "msg": "其实我真的挺帅的"
}
```

id为当前用户id，to为对象id

```
{
   "data": "OK"
}
```

### 拉取blog

接口

```
GET /pull-blog/{id:[0-9]+}/{lastId:[0-9]+}
```

响应结构

```
{
   "data": {
      ""
   }
}
```

### 存储结构

-- join_cloud_node.db
  -- msg_x_y    消息记录桶，每个用户*对*一个桶，key为消息id，递增
  -- msg_cursor 消息游标桶，记录每个桶的最大id
  -- peers_info 节点互联信息桶
  

## 数据合规解决方案

在数据生成链路上加入**插件池**工作区间，任何需要上公有链发表的文件，都需要持有插件池中的插件工作量证明，并将证明上报仲裁节点授信，仲裁节点通过后颁发工作量证明有效证书（类似发币）。

主要有以下几个特点：

1. 插件由公链平台开发可集成到C端节点或公有仲裁节点中，满足公链数据合规要求的工作量签章
2. 运算量小的可集成到C端瘦节点，运算量大的则由C端上报数据到就近的仲裁节点，再由仲裁节点运算证明并签章
3. 插件池中的插件可以逐个执行，也可并行，视具体的要求而定
4. 用户擅自拔掉插件则会造成区块缺失必要证书，无法通过公链节点群的验证，会导致公链节点群一致拒绝上链

如下图我们模拟节点发布博客如何满足所在地区的法律合规的要求：


## 数据开放协议

为了顺应AI与大数据时代的发展，个人可以贡献自己的数据给公网，计算一些对社会有意义的事情，比如出行大数据，公民健康大数据，用于国家层面分析与资源调度预备。
比如：大家把自己的出行或健康数据合规匿名并取得数据真实认证（认证过程只证真假，数据不留个人精确信息，如名字等，只留去哪里，生什么病）后，上报国家大数据中心，如果出行量大，病患多，国家用此来安排目的地的安全与预防医疗系统工作。




